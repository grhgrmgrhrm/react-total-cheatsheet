# `JSON Web Token` Cheatsheet :metal:

[–ù–∞ –≥–ª–∞–≤–Ω—É—é](../README.md)

#### `JSON Web Token` - —ç—Ç–æ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è (–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏) –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è <a href="https://jwt.io/">JSON Web Tokens</a>

> [–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è](https://tools.ietf.org/html/rfc7519)&nbsp;&nbsp;üëÄ

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–£—Å—Ç–∞–Ω–æ–≤–∫–∞](#install)
- [–ü–æ–¥–ø–∏—Å–∞–Ω–∏–µ (—Å–æ–∑–¥–∞–Ω–∏–µ) —Ç–æ–∫–µ–Ω–∞](#sign)
- [–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ (–ø—Ä–æ–≤–µ—Ä–∫–∞) —Ç–æ–∫–µ–Ω–∞](#verify)
- [–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ (–¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ) —Ç–æ–∫–µ–Ω–∞](#decode)
- [–û—à–∏–±–∫–∏](#errors)

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ <a name="install"></a>

```bash
yarn add jsonwebtoken
# –∏–ª–∏
npm i jsonwebtoken
```

## –ü–æ–¥–ø–∏—Å–∞–Ω–∏–µ (—Å–æ–∑–¥–∞–Ω–∏–µ) —Ç–æ–∫–µ–Ω–∞ <a name="sign"></a>

```js
const jwt = require('jsonwebtoken')

jwt.sign(payload, secretOrPrivateKey, [options, callback])

// –ü—Ä–∏–º–µ—Ä
jwt.sign({
    username: 'John',
    email: 'john@email.com'
  },
  'secret',
  {
    expiresIn: '1h'
  }
)
```

–ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω –∫–æ–ª–±–µ–∫, —Ç–æ –º–µ—Ç–æ–¥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ. –î–∞–Ω–Ω—ã–π –∫–æ–ª–±–µ–∫ –ø–æ–ª—É—á–∞–µ—Ç –æ–±—ä–µ–∫—Ç –æ—à–∏–±–∫–∏ `err`. –í –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ, –º–µ—Ç–æ–¥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, –≤–æ–∑–≤—Ä–∞—â–∞—è —Ç–æ–∫–µ–Ω –≤ –≤–∏–¥–µ —Å—Ç—Ä–æ–∫–∏.

### –ê—Ä–≥—É–º–µ–Ω—Ç—ã

- `payload` - –ø–æ–ª–µ–∑–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞: –æ–±—ä–µ–∫—Ç, –±—É—Ñ–µ—Ä –∏–ª–∏ —Å—Ç—Ä–æ–∫–∞, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–∏–µ –≤–∞–ª–∏–¥–Ω—ã–π JSON. –û–±—ä–µ–∫—Ç –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é –º–µ—Ç–æ–¥–∞ `JSON.stringify()`
- `secretOrPrivateKey` - —Å—Ç—Ä–æ–∫–∞, –±—É—Ñ–µ—Ä –∏–ª–∏ –æ–±—ä–µ–∫—Ç, —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ —Å–µ–∫—Ä–µ—Ç –¥–ª—è –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ HMAC –∏–ª–∏ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Å –ø–æ–º–æ—â—å—é —Å—Ö–µ–º—ã PEM –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è RSA –∏ ECDSA

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏

- [Registered claim names](https://tools.ietf.org/html/rfc7519#section-4.1)
- [Creating and Validating JWTs](https://tools.ietf.org/html/rfc7519#section-7)

- `algorithm` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `HS256`)
- `expiresIn` - –≤—Ä–µ–º—è, –≤ —Ç–µ—á–µ–Ω–∏–µ –∫–æ—Ç–æ—Ä–æ–≥–æ —Ç–æ–∫–µ–Ω —Å—á–∏—Ç–∞–µ—Ç—Å—è –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º: 100 - 100 —Å, '100' - 100 –º—Å, '1h' - 1 —á–∞—Å, '2d' - 2 –¥–Ω—è
- `notBefore` - –≤—Ä–µ–º—è, –ø–æ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ –∫–æ—Ç–æ—Ä–æ–≥–æ —Ç–æ–∫–µ–Ω –±—É–¥–µ—Ç —Å—á–∏—Ç–∞—Ç—å—Å—è –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º
- `audience`
- `issuer`
- `jwtid`
- `subject`
- `noTimestamp`
- `header`
- `keyid`
- `mutatePayload` - –µ—Å–ª–∏ –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ `true`, —Ñ—É–Ω–∫—Ü–∏—è `sign()` –±—É–¥–µ—Ç –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –æ–±—ä–µ–∫—Ç `payload` –Ω–∞–ø—Ä—è–º—É—é. –≠—Ç–æ –±—ã–≤–∞–µ—Ç –ø–æ–ª–µ–∑–Ω—ã–º, –∫–æ–≥–¥–∞ –Ω–∞–º –Ω—É–∂–Ω–∞ "—Å—ã—Ä–∞—è" —Å—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ–ª–µ–∑–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∫ –Ω–µ–π –Ω–∞—Å—Ç—Ä–æ–µ–∫, –Ω–æ –¥–æ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è.

–ù–∞—Å—Ç—Ä–æ–π–∫–∏ `expiresIn`, `notBefore`, `audience`, `subject`, `issuer` –º–æ–≥—É—Ç –±—ã—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –ø—Ä—è–º–æ –≤ `payload` –∫–∞–∫ `exp`, `nbf`, `aud`, `sub` –∏ `iss`, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ.

–ó–∞–≥–æ–ª–æ–≤–æ–∫ –º–æ–∂–µ—Ç –±—ã—Ç—å –∫–∞—Å—Ç–æ–º–∏–∑–∏—Ä–æ–≤–∞–Ω —á–µ—Ä–µ–∑ –æ–±—ä–µ–∫—Ç `options.header`.

–í —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π `jwt` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–∫–ª—é—á–∞–µ—Ç—Å—è `iat` (–≤—Ä–µ–º—è –≤—ã–ø—É—Å–∫–∞, —Å–æ–∑–¥–∞–Ω–∏—è), –µ—Å–ª–∏ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ `noTimestamp: true`.

#### –ü—Ä–∏–º–µ—Ä —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –ø–æ–¥–ø–∏—Å–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `RSA SHA256`

```js
const privateKey = fs.readFileSync('private.key')
const token = jwt.sign({ name: 'John Smith' }, privateKey, { algorithm: 'RS256' })
```

#### –ü—Ä–∏–º–µ—Ä –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –ø–æ–¥–ø–∏—Å–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–∞

```js
jwt.sign({ name: 'John Smith' }, privateKey, { algorithm: 'RS256' }, (err, token) => {
  if (err) console.error(err)
  console.log(token)
})
```

## –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ (–ø—Ä–æ–≤–µ—Ä–∫–∞) —Ç–æ–∫–µ–Ω–∞ <a name="verify"></a>

```js
const jwt = required('jsonwebtoken')

jwt.verify(token, secretOrPublicKey, [options, callback])
```

–ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω –∫–æ–ª–±–µ–∫, —Ç–æ –º–µ—Ç–æ–¥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ. –î–∞–Ω–Ω—ã–π –∫–æ–ª–±–µ–∫ –ø–æ–ª—É—á–∞–µ—Ç –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—É—é –ø–æ–ª–µ–∑–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É –ø—Ä–∏ —É—Å–ª–æ–≤–∏–∏ –≤–∞–ª–∏–¥–Ω–æ–π —Å–∏–≥–Ω–∞—Ç—É—Ä—ã –∏ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫. –í –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ, –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –∏—Å–∫–ª—é—á–µ–Ω–∏–µ.

–ë–µ–∑ –∫–æ–ª–±–µ–∫–∞ –º–µ—Ç–æ–¥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, –≤–æ–∑–≤—Ä–∞—â–∞—è –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π `payload` –ø—Ä–∏ —É—Å–ª–æ–≤–∏–∏ –≤–∞–ª–∏–¥–Ω–æ–π —Å–∏–≥–Ω–∞—Ç—É—Ä—ã –∏ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫. –í –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ, –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –∏—Å–∫–ª—é—á–µ–Ω–∏–µ.

### –ê—Ä–≥—É–º–µ–Ω—Ç—ã

- `token`
- `secretOrPublicKey` - –µ—Å–ª–∏ `jwt.verify()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, –¥–∞–Ω–Ω—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å —Ñ—É–Ω–∫—Ü–∏–µ–π, –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—â–µ–π —Å–µ–∫—Ä–µ—Ç –∏–ª–∏ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á. –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Å–µ–∫—Ä–µ—Ç–∞ –æ–∂–∏–¥–∞—é—Ç –ø–æ–ª—É—á–∏—Ç—å —Å—Ç—Ä–æ–∫—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ base64. –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –≤–º–µ—Å—Ç–æ `secret` —Å–ª–µ–¥—É–µ—Ç –ø–µ—Ä–µ–¥–∞—Ç—å `Buffer.from(secret, 'base64')`

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏

- `algorithms` - –º–∞—Å—Å–∏–≤ —Å –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ (['HS256', 'HS384'])
- `audience`
- `complete` - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç `{ payload, header, signature }` –≤–º–µ—Å—Ç–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –ø–æ–ª–µ–∑–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏
- `issuer`
- `jwtid`
- `ignoreExpiration` - –µ—Å–ª–∏ `true`, –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Ç–æ–∫–µ–Ω–∞ –±—É–¥–µ—Ç –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
- `ignoreNotBefore`
- `subject`
- `clockTolerance` - –¥–æ–ø—É—Å—Ç–∏–º–∞—è —Ä–∞–∑–Ω–∏—Ü–∞ –≤–æ –≤—Ä–µ–º–µ–Ω–∏ –≤ —Å–µ–∫
- `maxAge` - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –¥–æ–ø—É—Å—Ç–∏–º—ã–π "–≤–æ–∑—Ä–∞—Å—Ç" —Ç–æ–∫–µ–Ω–∞ (100, '100', '1h', '2d')
- `clockTimestamp` - –≤—Ä–µ–º—è –≤ —Å–µ–∫, –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–µ –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Ç–µ–∫—É—â–µ–≥–æ –¥–ª—è –≤—Å–µ—Ö —Å—Ä–∞–≤–Ω–µ–Ω–∏–π
- `nonce` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `Open ID` –¥–ª—è ID —Ç–æ–∫–µ–Ω–æ–≤

### –ü—Ä–∏–º–µ—Ä—ã

```js
// –°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞
try {
  const decoded = jwt.verify(token, 'secret')
  console.log(decoded.name) // John
} catch (err) {
  console.error(err)
}

// –∏–ª–∏
jwt.verify(token, 'secret', (err, decoded) => {
  if (err) console.error(err)
  console.log(decoded.name) // John
})

// –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∞—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞
const cert = fs.readFileSync('public.pem') // –ø–æ–ª—É—á–∞–µ–º –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á
jwt.verify(token, cert, (err, decoded) => {
  if (err) console.error(err)
  console.log(decoded.name) // John
})

// –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
const cert = fs.readFileSync('public.pem') // –ø–æ–ª—É—á–∞–µ–º –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á
jwt.verify(token, cert, { audience: 'urn:john', issuer: 'urn:issuer', jwtid: 'jwtid', subject: 'subject' }, (err, decoded) => {})

// –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å –ø–æ–º–æ—â—å—é –∫–æ–ª–±–µ–∫–∞ `getKey()`
const jwksClient = require('jwks-rsa')
const client = jwksClient({
  jwksUri: 'https://example.com/.well-known/jwks.json'
})
function getKey(header, callback) {
  client.getSigningKey(header.kid, (err, key) => {
    const signingKey = key.publicKey || key.rsaPublicKey
    callback(null, signingKey)
  })
}
jwt.verify(token, getKey, options, (err, decoded) => {
  if (err) console.error(err)
  console.log(decoded.name) // John
})
```

## –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ (–¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ) —Ç–æ–∫–µ–Ω–∞ <a name="decode"></a>

```js
jwt.decode(token, [options])
```

–ú–µ—Ç–æ–¥ —è–≤–ª—è–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω –±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ —Å–∏–≥–Ω–∞—Ç—É—Ä—ã.

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏

- `json` - –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ `JSON.parse()` –∫ `payload`
- `complete` - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç `{ payload, header }`

### –ü—Ä–∏–º–µ—Ä

```js
const decoded = jwt.decode(token)
console.log(decoded.name) // John
```

## –û—à–∏–±–∫–∏ <a name="errors"></a>

- `TokenExpiredError`
  - name
  - message: 'jwt expired'
  - expiredAt
- `JsonWebTokenError`
  - name
  - messages:
    - 'invalid token'
    - 'jwt malformed'
    - 'jwt signature is required'
    - 'invalid signature'
    - 'jwt audience | issuer | id | subject invalid. expected: ...'
- `NotBeforeError`
  - name
  - message: 'jwt not active'
  - date